<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Liên kết hết hạn</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/styles/reset.css">
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/verify_expired.css">
    <link rel="stylesheet" href="/styles/loader.css">
<!--    <link rel="stylesheet" href="/styles/verify_success.css">-->
</head>
<body>
<main>
    <div class="verify expired">
        <i class="verify__icon fa-solid fa-clock"></i>
    </div>
    <h1>Liên kết đã hết hạn</h1>
    <p>Liên kết xác thực đã hết hạn. Vui lòng đăng ký lại để nhận email mới.</p>
    <button onclick="resend()">Gửi lại email xác thực</button>
</main>
<div id="loader" class="overlay_loader">
    <div class="cssload-loader">
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
        <div class="cssload-side"></div>
    </div>
</div>

<script>
    async function resend() {

        const loader = document.getElementById("loader");
        loader.classList.add("active");

        const params = new URLSearchParams(window.location.search);
        const email = params.get("email");

        try {
            const res = await fetch("/auth/resend-verification", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ email })
            });

            const data = await res.json();

            if (!res.ok) {
                throw new Error(data.message);
            }

            alert("Đã gửi lại email xác thực!");

        } catch (err) {
            alert(err.message);
        } finally {
            loader.classList.remove("active");
        }
    }
</script>
</body>
</html>
